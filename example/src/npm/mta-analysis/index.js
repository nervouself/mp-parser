function getNetworkType(t){wx.getNetworkType({success:function(n){t(n.networkType)}})}function getSystemInfo(){var t=wx.getSystemInfoSync();return{adt:encodeURIComponent(t.model),scl:t.pixelRatio,scr:t.windowWidth+"x"+t.windowHeight,lg:t.language,fl:t.version,jv:encodeURIComponent(t.system),tz:encodeURIComponent(t.platform)}}function getUID(){try{return wx.getStorageSync(MTA_CONFIG.prefix+"auid")}catch(t){}}function setUID(){try{var t=getRandom();return wx.setStorageSync(MTA_CONFIG.prefix+"auid",t),t}catch(t){}}function getSID(){try{return wx.getStorageSync(MTA_CONFIG.prefix+"ssid")}catch(t){}}function setSID(){try{var t="s"+getRandom();return wx.setStorageSync(MTA_CONFIG.prefix+"ssid",t),t}catch(t){}}function getRandom(t){for(var n=[0,1,2,3,4,5,6,7,8,9],e=10;1<e;e--){var a=Math.floor(10*Math.random()),o=n[a];n[a]=n[e-1],n[e-1]=o}for(e=a=0;5>e;e++)a=10*a+n[e];return(t||"")+(a+"")+ +new Date}function getPagePath(){try{var t=getCurrentPages(),n="/";return 0<t.length&&(n=t.pop().__route__),n}catch(t){console.log("get current page path error:"+t)}}function getMainInfo(){var t={dm:"wechat.apps.xx",url:getPagePath(),pvi:"",si:"",ty:0};return t.pvi=function(){var n=getUID();return n||(n=setUID(),t.ty=1),n}(),t.si=function(){var t=getSID();return t||(t=setSID()),t}(),t}function getBasicInfo(){var t=getSystemInfo();return getNetworkType(function(t){try{wx.setStorageSync(MTA_CONFIG.prefix+"ntdata",t)}catch(t){}}),t.ct=wx.getStorageSync(MTA_CONFIG.prefix+"ntdata")||"4g",t}function getExtentInfo(){var t,n=MTA.Data.userInfo,e=[];for(t in n)n.hasOwnProperty(t)&&e.push(t+"="+n[t]);return n=e.join(";"),{r2:MTA_CONFIG.app_id,r4:"wx",ext:"v="+MTA_CONFIG.version+(null!==n&&""!==n?";ui="+encodeURIComponent(n):"")}}var MTA_CONFIG={app_id:"",event_id:"",api_base:"https://pingtas.qq.com/pingd",prefix:"_mta_",version:"1.3.5",stat_share_app:!1,stat_pull_down_fresh:!1,stat_reach_bottom:!1},MTA={App:{init:function(t){"appID"in t&&(MTA_CONFIG.app_id=t.appID),"eventID"in t&&(MTA_CONFIG.event_id=t.eventID),"statShareApp"in t&&(MTA_CONFIG.stat_share_app=t.statShareApp),"statPullDownFresh"in t&&(MTA_CONFIG.stat_pull_down_fresh=t.statPullDownFresh),"statReachBottom"in t&&(MTA_CONFIG.stat_reach_bottom=t.statReachBottom),setSID(),"lauchOpts"in t&&(MTA.Data.lanchInfo=t.lauchOpts,MTA.Data.lanchInfo.landing=1)}},Page:{init:function(){var t=getCurrentPages()[getCurrentPages().length-1];t.onShow&&function(){var n=t.onShow;t.onShow=function(){MTA.Page.stat(),n.call(this,arguments)}}(),MTA_CONFIG.stat_pull_down_fresh&&t.onPullDownRefresh&&function(){var n=t.onPullDownRefresh;t.onPullDownRefresh=function(){MTA.Event.stat(MTA_CONFIG.prefix+"pulldownfresh",{url:t.__route__}),n.call(this,arguments)}}(),MTA_CONFIG.stat_reach_bottom&&t.onReachBottom&&function(){var n=t.onReachBottom;t.onReachBottom=function(){MTA.Event.stat(MTA_CONFIG.prefix+"reachbottom",{url:t.__route__}),n.call(this,arguments)}}(),MTA_CONFIG.stat_share_app&&t.onShareAppMessage&&function(){var n=t.onShareAppMessage;t.onShareAppMessage=function(){return MTA.Event.stat(MTA_CONFIG.prefix+"shareapp",{url:t.__route__}),n.call(this,arguments)}}()},stat:function(){if(""!=MTA_CONFIG.app_id){var t=[],n=getExtentInfo(),e=[getMainInfo(),n,getBasicInfo()];MTA.Data.lanchInfo&&(e.push({ht:MTA.Data.lanchInfo.scene,rdm:"/",rurl:MTA.Data.lanchInfo.path}),MTA.Data.lanchInfo.query&&MTA.Data.lanchInfo.query._mta_ref_id&&e.push({rarg:MTA.Data.lanchInfo.query._mta_ref_id}),1==MTA.Data.lanchInfo.landing&&(n.ext+=";lp=1",MTA.Data.lanchInfo.landing=0)),e.push({rand:+new Date}),n=0;for(var a=e.length;n<a;n++)for(var o in e[n])e[n].hasOwnProperty(o)&&t.push(o+"="+(void 0===e[n][o]?"":e[n][o]));wx.request({url:MTA_CONFIG.api_base+"?"+t.join("&").toLowerCase()})}}},Event:{stat:function(t,n){if(""!=MTA_CONFIG.event_id){var e=[],a=getMainInfo(),o=getExtentInfo();a.dm="wxapps.click",a.url=t,o.r2=MTA_CONFIG.event_id;var r,i=void 0===n?{}:n,s=[];for(r in i)i.hasOwnProperty(r)&&s.push(encodeURIComponent(r)+"="+encodeURIComponent(i[r]));for(i=s.join(";"),o.r5=i,i=0,a=[a,o,getBasicInfo(),{rand:+new Date}],o=a.length;i<o;i++)for(var c in a[i])a[i].hasOwnProperty(c)&&e.push(c+"="+(void 0===a[i][c]?"":a[i][c]));wx.request({url:MTA_CONFIG.api_base+"?"+e.join("&").toLowerCase()})}}},Data:{userInfo:null,lanchInfo:null}};module.exports=MTA;